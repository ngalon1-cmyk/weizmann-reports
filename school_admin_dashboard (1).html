<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×“×™×•×•×—×™× - ×‘×™×ª ×¡×¤×¨ ×•×™×¦××Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-right: 4px solid #667eea;
        }
        
        .stat-card.warning {
            border-right-color: #ffc107;
        }
        
        .stat-card.success {
            border-right-color: #28a745;
        }
        
        .stat-card.danger {
            border-right-color: #dc3545;
        }
        
        .stat-number {
            font-size: 42px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 16px;
        }
        
        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls select,
        .controls input {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 15px;
        }
        
        .controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .reports-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .report-card {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-right: 4px solid #667eea;
            transition: all 0.3s;
        }
        
        .report-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .report-card.pending {
            border-right-color: #ffc107;
        }
        
        .report-card.resolved {
            border-right-color: #28a745;
            opacity: 0.8;
        }
        
        .report-card.high {
            border-right-color: #dc3545;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .report-id {
            font-size: 12px;
            color: #6c757d;
        }
        
        .badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .badge-status {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-status.resolved {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-urgency {
            background: #e9ecef;
            color: #495057;
        }
        
        .badge-urgency.high {
            background: #f8d7da;
            color: #721c24;
        }
        
        .badge-urgency.medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-type {
            background: #cfe2ff;
            color: #084298;
        }
        
        .report-location {
            font-size: 20px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
        }
        
        .report-details {
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.8;
        }
        
        .report-description {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .report-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .report-photos img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .report-photos img:hover {
            transform: scale(1.05);
        }
        
        .report-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .report-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .reporter-info {
            background: #e9ecef;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .reported-to {
            background: #d1ecf1;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #0c5460;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        /* Modal for photo viewing */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 40px;
            color: white;
            cursor: pointer;
            background: rgba(0,0,0,0.5);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Email modal */
        .email-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }
        
        .email-modal.show {
            display: flex;
        }
        
        .email-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .email-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .email-body {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            line-height: 1.8;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            border: 2px solid #dee2e6;
        }
        
        .email-actions {
            display: flex;
            gap: 10px;
        }
        
        .heatmap {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .heatmap h3 {
            margin-bottom: 20px;
            color: #495057;
        }
        
        .type-stat {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .type-name {
            width: 200px;
            font-weight: 600;
            color: #495057;
        }
        
        .type-bar {
            flex: 1;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .type-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-left: 10px;
        }
        
        .type-count {
            color: white;
            font-weight: 600;
            font-size: 14px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š × ×™×”×•×œ ×“×™×•×•×—×™× - ×‘×™×ª ×¡×¤×¨ ×•×™×¦××Ÿ</h1>
            <p>××¢×¨×›×ª × ×™×”×•×œ ×“×™×•×•×—×™× ×¢×œ ××¤×’×¢×™× ×‘×¡×‘×™×‘×ª ×‘×™×ª ×”×¡×¤×¨</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card warning">
                <div class="stat-number" id="pendingCount">0</div>
                <div class="stat-label">â³ ×“×™×•×•×—×™× ×¤×¢×™×œ×™×</div>
            </div>
            <div class="stat-card success">
                <div class="stat-number" id="resolvedCount">0</div>
                <div class="stat-label">âœ… ×“×™×•×•×—×™× ×©×˜×•×¤×œ×•</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-number" id="urgentCount">0</div>
                <div class="stat-label">ğŸ”´ ×“×™×•×•×—×™× ×“×—×•×¤×™×</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ğŸ“ˆ ×¡×”"×› ×“×™×•×•×—×™×</div>
            </div>
        </div>
        
        <div class="heatmap">
            <h3>ğŸ“Š ×”×ª×¤×œ×’×•×ª ×“×™×•×•×—×™× ×œ×¤×™ ×¡×•×’ ××¤×’×¢</h3>
            <div id="typeHeatmap"></div>
        </div>
        
        <div class="controls">
            <select id="filterStatus">
                <option value="all">×›×œ ×”×“×™×•×•×—×™×</option>
                <option value="pending">×¤×¢×™×œ×™× ×‘×œ×‘×“</option>
                <option value="resolved">×˜×•×¤×œ×• ×‘×œ×‘×“</option>
            </select>
            
            <select id="filterUrgency">
                <option value="all">×›×œ ×¨××•×ª ×”×“×—×™×¤×•×ª</option>
                <option value="high">×“×—×•×¤×™× ×‘×œ×‘×“</option>
                <option value="medium">×“×—×™×¤×•×ª ×‘×™× ×•× ×™×ª</option>
                <option value="low">×“×—×™×¤×•×ª × ××•×›×”</option>
            </select>
            
            <select id="filterType">
                <option value="all">×›×œ ×¡×•×’×™ ×”××¤×’×¢×™×</option>
            </select>
            
            <input type="text" id="searchBox" placeholder="×—×™×¤×•×©..." style="flex: 1; min-width: 200px;">
            
            <button class="btn-success" onclick="exportToCSV()">ğŸ“¥ ×™×™×¦×•× ×œ××§×¡×œ</button>
            <button class="btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
        </div>
        
        <div class="reports-container">
            <h2 style="margin-bottom: 20px; color: #495057;">×“×™×•×•×—×™×</h2>
            <div id="reportsList"></div>
        </div>
    </div>
    
    <div id="photoModal" class="modal">
        <span class="modal-close" onclick="closeModal()">Ã—</span>
        <img id="modalImage" src="" alt="×ª××•× ×”">
    </div>
    
    <div id="emailModal" class="email-modal">
        <div class="email-content">
            <h2>ğŸ“§ ××™×™×œ ×œ×©×œ×™×—×” ×œ××“×•×•×—</h2>
            <div class="email-body" id="emailBody"></div>
            <div class="email-actions">
                <button class="btn-success" onclick="copyEmail()">ğŸ“‹ ×”×¢×ª×§ ××™×™×œ</button>
                <button class="btn-primary" onclick="closeEmailModal()">×¡×’×•×¨</button>
            </div>
        </div>
    </div>

    <script>
        // Password protection
        const ADMIN_PASSWORD = 'ng5495341';
        
        function checkPassword() {
            const savedPassword = sessionStorage.getItem('adminAuth');
            if (savedPassword === ADMIN_PASSWORD) {
                return true;
            }
            
            const enteredPassword = prompt('ğŸ”’ ×”×–×Ÿ ×¡×™×¡××” ×œ×’×™×©×” ×œ×œ×•×— ×”×‘×§×¨×”:');
            if (enteredPassword === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminAuth', ADMIN_PASSWORD);
                return true;
            } else if (enteredPassword !== null) {
                alert('âŒ ×¡×™×¡××” ×©×’×•×™×”! ×”×’×™×©×” × ×“×—×ª×”.');
            }
            window.location.href = 'index.html';
            return false;
        }
        
        // Check password on page load
        if (!checkPassword()) {
            document.body.innerHTML = '<div style="text-align:center; padding:50px; font-family:Arial;">×’×™×©×” × ×“×—×ª×”</div>';
        }
        
        let allReports = [];
        let filteredReports = [];
        
        const issueTypeLabels = {
            'infrastructure': 'ğŸ—ï¸ ×ª×©×ª×™×•×ª ×•××‘× ×”',
            'traffic_safety': 'ğŸš¸ ×‘×˜×™×—×•×ª ×•×ª× ×•×¢×”',
            'yard_environment': 'ğŸŒ³ ×—×¦×¨ ×•×¡×‘×™×‘×”',
            'cleanliness': 'ğŸš® × ×™×§×™×•×Ÿ ×•×¡× ×™×˜×¦×™×”',
            'electricity': 'âš¡ ×—×©××œ ×•×ª××•×¨×”',
            'equipment': 'ğŸ’ ×¦×™×•×“ ×œ×™××•×“×™ ×•×¨×™×”×•×˜',
            'security': 'ğŸ” ××‘×˜×—×” ×•×•× ×“×œ×™×–×',
            'other': 'ğŸ“ ××—×¨'
        };
        
        const urgencyLabels = {
            'low': '×“×—×™×¤×•×ª × ××•×›×”',
            'medium': '×“×—×™×¤×•×ª ×‘×™× ×•× ×™×ª',
            'high': '×“×—×•×£'
        };
        
        function loadReports() {
            allReports = JSON.parse(localStorage.getItem('schoolReports') || '[]');
            applyFilters();
            updateStats();
            updateHeatmap();
            loadTypeFilter();
        }
        
        function applyFilters() {
            const statusFilter = document.getElementById('filterStatus').value;
            const urgencyFilter = document.getElementById('filterUrgency').value;
            const typeFilter = document.getElementById('filterType').value;
            const searchText = document.getElementById('searchBox').value.toLowerCase();
            
            filteredReports = allReports.filter(report => {
                const matchesStatus = statusFilter === 'all' || report.status === statusFilter;
                const matchesUrgency = urgencyFilter === 'all' || report.urgency === urgencyFilter;
                const matchesType = typeFilter === 'all' || report.issueType === typeFilter;
                const matchesSearch = !searchText || 
                    report.description.toLowerCase().includes(searchText) ||
                    report.location.toLowerCase().includes(searchText) ||
                    report.reporterName.toLowerCase().includes(searchText);
                
                return matchesStatus && matchesUrgency && matchesType && matchesSearch;
            });
            
            renderReports();
        }
        
        function renderReports() {
            const container = document.getElementById('reportsList');
            
            if (filteredReports.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>××™×Ÿ ×“×™×•×•×—×™× ×œ×”×¦×’×”</h3>
                        <p>×œ× × ××¦××• ×“×™×•×•×—×™× ×”×ª×•×××™× ××ª ×”×¡×™× ×•×Ÿ</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredReports.map(report => `
                <div class="report-card ${report.status} ${report.urgency}">
                    <div class="report-header">
                        <div>
                            <div class="report-id">${report.id}</div>
                            <div class="report-location">ğŸ“ ${report.location}</div>
                        </div>
                        <div class="badges">
                            <span class="badge badge-status ${report.status}">
                                ${report.status === 'pending' ? 'â³ ×××ª×™×Ÿ ×œ×˜×™×¤×•×œ' : 'âœ… ×˜×•×¤×œ'}
                            </span>
                            <span class="badge badge-urgency ${report.urgency}">
                                ${report.urgency === 'high' ? 'ğŸ”´' : report.urgency === 'medium' ? 'ğŸŸ¡' : 'ğŸŸ¢'} 
                                ${urgencyLabels[report.urgency]}
                            </span>
                            <span class="badge badge-type">
                                ${issueTypeLabels[report.issueType]}
                            </span>
                        </div>
                    </div>
                    
                    <div class="reporter-info">
                        <strong>××“×•×•×—/×ª:</strong> ${report.reporterName} | 
                        <strong>ğŸ“§</strong> ${report.reporterEmail} ${report.reporterPhone ? '| <strong>ğŸ“±</strong> ' + report.reporterPhone : ''}<br>
                        <strong>×ª××¨×™×š:</strong> ${report.dateReported}
                    </div>
                    
                    ${report.reportedTo && report.reportedTo.length > 0 ? `
                        <div class="reported-to">
                            <strong>â„¹ï¸ ×”××“×•×•×— ×“×™×•×•×— ×’× ×œ:</strong> ${report.reportedTo.join(', ')}
                        </div>
                    ` : ''}
                    
                    <div class="report-description">
                        <strong>×ª×™××•×¨ ×”××¤×’×¢:</strong><br>
                        ${report.description}
                    </div>
                    
                    ${report.photos && report.photos.length > 0 ? `
                        <div class="report-photos">
                            ${report.photos.map((photo, index) => `
                                <img src="${photo.data}" alt="×ª××•× ×” ${index + 1}" 
                                     onclick="openPhotoModal('${photo.data}')">
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="report-actions">
                        ${report.status === 'pending' ? `
                            <button class="btn-success" onclick="markAsResolved('${report.id}')">
                                âœ… ×¡××Ÿ ×›×˜×•×¤×œ ×•×©×œ×— ××™×™×œ
                            </button>
                        ` : `
                            <button class="btn-primary" onclick="markAsPending('${report.id}')">
                                â†©ï¸ ×”×—×–×¨ ×œ×¤×¢×™×œ×™×
                            </button>
                        `}
                        <button class="btn-danger" onclick="deleteReport('${report.id}')">
                            ğŸ—‘ï¸ ××—×§
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function updateStats() {
            const pending = allReports.filter(r => r.status === 'pending').length;
            const resolved = allReports.filter(r => r.status === 'resolved').length;
            const urgent = allReports.filter(r => r.urgency === 'high' && r.status === 'pending').length;
            const total = allReports.length;
            
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('resolvedCount').textContent = resolved;
            document.getElementById('urgentCount').textContent = urgent;
            document.getElementById('totalCount').textContent = total;
        }
        
        function updateHeatmap() {
            const typeCounts = {};
            allReports.forEach(r => {
                typeCounts[r.issueType] = (typeCounts[r.issueType] || 0) + 1;
            });
            
            const maxCount = Math.max(...Object.values(typeCounts), 1);
            const sorted = Object.entries(typeCounts).sort((a, b) => b[1] - a[1]);
            
            const container = document.getElementById('typeHeatmap');
            
            if (sorted.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center;">××™×Ÿ × ×ª×•× ×™× ×œ×”×¦×’×”</p>';
                return;
            }
            
            container.innerHTML = sorted.map(([type, count]) => {
                const percentage = (count / maxCount) * 100;
                return `
                    <div class="type-stat">
                        <div class="type-name">${issueTypeLabels[type]}</div>
                        <div class="type-bar">
                            <div class="type-bar-fill" style="width: ${percentage}%">
                                <span class="type-count">${count}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadTypeFilter() {
            const types = [...new Set(allReports.map(r => r.issueType))].sort();
            const select = document.getElementById('filterType');
            const currentValue = select.value;
            
            select.innerHTML = '<option value="all">×›×œ ×¡×•×’×™ ×”××¤×’×¢×™×</option>' +
                types.map(t => `<option value="${t}">${issueTypeLabels[t]}</option>`).join('');
            
            if (types.includes(currentValue)) {
                select.value = currentValue;
            }
        }
        
        function markAsResolved(reportId) {
            const report = allReports.find(r => r.id === reportId);
            if (!report) return;
            
            // Generate email content
            const emailContent = `× ×•×©×: ×”×“×™×•×•×— ×©×œ×š ×¢×œ ××¤×’×¢ ×‘×¡×‘×™×‘×ª ×‘×™×ª ×”×¡×¤×¨ ×˜×•×¤×œ

×©×œ×•× ${report.reporterName},

×¨×¦×™× ×• ×œ×¢×“×›×Ÿ ××•×ª×š ×©×”×“×™×•×•×— ×©×œ×š ×¢×œ "${issueTypeLabels[report.issueType]}" ×‘××™×§×•× ${report.location} ×”×•×¢×‘×¨ ×œ×˜×™×¤×•×œ ×”×’×•×¨××™× ×”×¨×œ×•×•× ×˜×™×™×.

×¤×¨×˜×™ ×”×“×™×•×•×—:
- ×¡×•×’ ×”××¤×’×¢: ${issueTypeLabels[report.issueType]}
- ××™×§×•×: ${report.location}
- ×ª××¨×™×š ×“×™×•×•×—: ${report.dateReported}
- ×ª×™××•×¨: ${report.description}

${report.reportedTo && report.reportedTo.length > 0 ? `×”×“×™×•×•×— ×”×•×¢×‘×¨ ×œ×˜×™×¤×•×œ, ×‘× ×•×¡×£ ×œ×“×™×•×•×— ×”×™×©×™×¨ ×©×œ×š ×œ: ${report.reportedTo.join(', ')}` : '×”×“×™×•×•×— ×”×•×¢×‘×¨ ×œ×’×•×¨××™× ×”×¨×œ×•×•× ×˜×™×™× ×‘×‘×™×ª ×”×¡×¤×¨ ×•/××• ×‘×¢×™×¨×™×™×”.'}

×ª×•×“×” ×¨×‘×” ×¢×œ ×¢×¨× ×•×ª×š ×•×¢×œ ×©×™×ª×•×£ ×”×¤×¢×•×œ×” ×‘×©××™×¨×” ×¢×œ ×‘×˜×™×—×•×ª ×™×œ×“×™× ×•!

×‘×‘×¨×›×”,
×”× ×”×’×ª ×”×•×¨×™ ×‘×™×ª ×¡×¤×¨ ×•×™×¦××Ÿ

---
×–×”×• ××™×™×œ ××•×˜×•××˜×™ ×××¢×¨×›×ª ×”×“×™×•×•×—×™×. ×”× ×”×’×ª ×”×”×•×¨×™× ××”×•×•×” ×’×•×¨× ××ª×•×•×š ×œ×¨×™×›×•×– ×•×”×¢×‘×¨×ª ×”×“×™×•×•×—×™× ×‘×œ×‘×“.`;
            
            // Show email modal
            document.getElementById('emailBody').textContent = emailContent;
            document.getElementById('emailModal').classList.add('show');
            
            // Update report status
            report.status = 'resolved';
            report.dateResolved = new Date().toLocaleString('he-IL');
            localStorage.setItem('schoolReports', JSON.stringify(allReports));
            
            // Store email for copying
            window.currentEmail = emailContent;
            window.currentReportId = reportId;
        }
        
        function copyEmail() {
            navigator.clipboard.writeText(window.currentEmail).then(() => {
                alert('âœ… ×ª×•×›×Ÿ ×”××™×™×œ ×”×•×¢×ª×§ ×œ×œ×•×—!\n\n×¢×›×©×™×• ×ª×•×›×œ ×œ×”×“×‘×™×§ ××•×ª×• ×‘×ª×•×›× ×ª ×”××™×™×œ ×©×œ×š ×•×œ×©×œ×•×— ×œ:\n' + 
                      allReports.find(r => r.id === window.currentReportId).reporterEmail);
                closeEmailModal();
                loadReports();
            });
        }
        
        function closeEmailModal() {
            document.getElementById('emailModal').classList.remove('show');
        }
        
        function markAsPending(reportId) {
            const report = allReports.find(r => r.id === reportId);
            if (report) {
                report.status = 'pending';
                delete report.dateResolved;
                localStorage.setItem('schoolReports', JSON.stringify(allReports));
                loadReports();
            }
        }
        
        function deleteReport(reportId) {
            if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×“×™×•×•×—?')) return;
            
            allReports = allReports.filter(r => r.id !== reportId);
            localStorage.setItem('schoolReports', JSON.stringify(allReports));
            loadReports();
        }
        
        function clearAllData() {
            if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ×”×“×™×•×•×—×™×?\n\n×¤×¢×•×œ×” ×–×• ××™× ×” × ×™×ª× ×ª ×œ×‘×™×˜×•×œ!')) return;
            
            localStorage.removeItem('schoolReports');
            allReports = [];
            loadReports();
        }
        
        function exportToCSV() {
            if (allReports.length === 0) {
                alert('××™×Ÿ ×“×™×•×•×—×™× ×œ×™×™×¦×•×');
                return;
            }
            
            const headers = ['×ª××¨×™×š', '×¡×˜×˜×•×¡', '×“×—×™×¤×•×ª', '×¡×•×’ ××¤×’×¢', '×©× ××“×•×•×—', '××™××™×™×œ', '×˜×œ×¤×•×Ÿ', '××™×§×•×', '×ª×™××•×¨', '×“×•×•×— ×’× ×œ', '×ª××¨×™×š ×˜×™×¤×•×œ'];
            const rows = allReports.map(r => [
                r.dateReported,
                r.status === 'pending' ? '×××ª×™×Ÿ' : '×˜×•×¤×œ',
                urgencyLabels[r.urgency],
                issueTypeLabels[r.issueType],
                r.reporterName,
                r.reporterEmail,
                r.reporterPhone || '',
                r.location,
                r.description.replace(/,/g, ';').replace(/\n/g, ' '),
                r.reportedTo ? r.reportedTo.join('; ') : '',
                r.dateResolved || ''
            ]);
            
            const csv = [headers, ...rows]
                .map(row => row.map(cell => `"${cell}"`).join(','))
                .join('\n');
            
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `×“×™×•×•×—×™×_×‘×™×ª_×¡×¤×¨_×•×™×¦××Ÿ_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        function openPhotoModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('photoModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('photoModal').classList.remove('show');
        }
        
        // Event listeners
        document.getElementById('filterStatus').addEventListener('change', applyFilters);
        document.getElementById('filterUrgency').addEventListener('change', applyFilters);
        document.getElementById('filterType').addEventListener('change', applyFilters);
        document.getElementById('searchBox').addEventListener('input', applyFilters);
        
        // Close modals on click outside
        document.getElementById('photoModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        
        document.getElementById('emailModal').addEventListener('click', function(e) {
            if (e.target === this) closeEmailModal();
        });
        
        // Initialize
        loadReports();
        
        // Auto-refresh every 30 seconds
        setInterval(loadReports, 30000);
    </script>
</body>
</html>